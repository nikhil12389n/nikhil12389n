<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"
      integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk="
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
    />

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <title>Request Form</title>
  </head>
  <body onload="connectMetaMask();connectContract()">
    <div>
      <nav class="navbar navbar-expand-lg  btn btn-secondary ">
          <div class="container-fluid">
         
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav w-100 justify-content-between">
        <li class="nav-item">
          
          <a href="selectionpage.html"><button class="btn btn-dark" >Home</button></a>
        </li>
        <li>
            <p id="adstname"></p>
        </li>
        </ul>
            </div>
          </div>
        </nav>
  </div>
    <div class="form bs-tooltip-end">
      
      <h>Enter product</h>
      <input  type="text"  placeholder="product"  id="product" class="form-control" list="browser" name="browser"/>
      <datalist id="browser">
        <option value="Wheat"></option>
        <option value="Grains"></option>
        <option value="Eggs"></option>
        <option value="Rice"></option>
        <option value="Meals"></option>
      </datalist>
      <h> Enter Quantity</h>
      <input type="number" class="form-control" placeholder="quantity" min="1" id="quantity"/>
      <h>Enter date</h>
      <input type="date" class="form-control" placeholder="date" id="date1" />
      <button class="btn btn-dark" onclick="putdata(document.getElementById('adstname').innerText,document.getElementById('product').value,document.getElementById('quantity').value,document.getElementById('date1').value,'notsubmit')">Addmore</button>
      <hr />
      <h3>Details of your request</h3>

      <table id="example" style="width: 100%"></table>
    </div>
    <button class="btn btn-dark" onclick="putdata(document.getElementById('adstname').innerText,document.getElementById('product').value,document.getElementById('quantity').value,document.getElementById('date1').value,'submit')">Submit</button>
  </body>
  <script>
    document.getElementById("adstname").innerText=localStorage.getItem("ROLENAME");
      var table = $("#example").DataTable({
        columns: [
          { title: "RequestNo", data: "requestno" },

        

          { title: "product", data: "product" },
          { title: "quantity", data: "quantity" },
          { title: "date", data: "date" },
        ],
      });
    const connectMetaMask = async () => {
        if (window.ethereum !== "undefined") {
          const accounts = await ethereum.request({
            method: "eth_requestAccounts",
          });
          account = accounts[0];
          
        }
    };
    const connectContract = async () => {
        const ABI =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "div",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "to",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			}
		],
		"name": "acceptreqDDST",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[]",
				"name": "to",
				"type": "string[]"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "reqfrom",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "p",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "q",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "d",
				"type": "string"
			}
		],
		"name": "adstReceived",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "adstreceived",
		"outputs": [
			{
				"internalType": "string",
				"name": "reqfrom",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "acceptedby",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "adstsent",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "acceptedby",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "ddstReceived",
		"outputs": [
			{
				"internalType": "string",
				"name": "reqfrom",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "acceptedby",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "div",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "to",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			}
		],
		"name": "declinereqDDST",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "dgstreceived",
		"outputs": [
			{
				"internalType": "string",
				"name": "reqfrom",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "acceptedby",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "div",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "p",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "q",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "d",
				"type": "string"
			}
		],
		"name": "fillform",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "unit",
				"type": "string"
			}
		],
		"name": "getAllreqreceive",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "reqfrom",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "from",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "reqno",
						"type": "uint256"
					},
					{
						"internalType": "string[]",
						"name": "products",
						"type": "string[]"
					},
					{
						"internalType": "string[]",
						"name": "quantities",
						"type": "string[]"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "status",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "acceptedby",
						"type": "string"
					}
				],
				"internalType": "struct SCM.ReceivedReqforOthers[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "unit",
				"type": "string"
			}
		],
		"name": "getAllreqsent",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "reqno",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "from",
						"type": "string"
					},
					{
						"internalType": "string[]",
						"name": "products",
						"type": "string[]"
					},
					{
						"internalType": "string[]",
						"name": "quantities",
						"type": "string[]"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "status",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "acceptedby",
						"type": "string"
					}
				],
				"internalType": "struct SCM.ADSTSEND[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "div",
				"type": "string"
			}
		],
		"name": "getallreqreceivedddst",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "reqfrom",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "from",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "reqno",
						"type": "uint256"
					},
					{
						"internalType": "string[]",
						"name": "products",
						"type": "string[]"
					},
					{
						"internalType": "string[]",
						"name": "quantities",
						"type": "string[]"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "status",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "acceptedby",
						"type": "string"
					}
				],
				"internalType": "struct SCM.ReceivedReqforOthers[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			}
		],
		"name": "getrequestcount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "manufreceived",
		"outputs": [
			{
				"internalType": "string",
				"name": "reqfrom",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "acceptedby",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "requestcount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "reqno",
				"type": "uint256"
			}
		],
		"name": "track",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "trackorder",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]

const Address="0x0bC9deAc1587c634798855DcBb2FD3BD99C6D8d2";
        
        window.web3 = await new Web3(window.ethereum);
        window.contract = await new window.web3.eth.Contract(ABI, Address);
		console.log(window.contract);
        
    };
    const products=[];
    const quantities=[];
    const putdata=async(adstname,product,quantity,date,e)=>{
        const count=parseInt(await window.contract.methods.getrequestcount(document.getElementById("adstname").innerText).call());
       
        products.push(product);
        quantities.push(quantity);
       
        if(e=="notsubmit"){
        table.row.add({'requestno':count+1,'product':product,'quantity':quantity,'date':date}).draw();
        }
        if(e=="submit"){
            table.row.add({'requestno':count+1,'product':product,'quantity':quantity,'date':date}).draw();
            
            console.log(document.getElementById("adstname").innerText,products,quantities,date);
            let dup=document.getElementById("adstname").innerText;
            let ref="";
            for(let i=0;i<2;i++){
                ref+=dup[i];
            }
            if(ref=="D1"){
                dup="DIVISION1";
            }
            if(ref=="D2"){
                dup="DIVISION2";
            }
            if(ref=="D3"){
                dup="DIVISION3";
            }
        await window.contract.methods.fillform(dup,document.getElementById("adstname").innerText,products,quantities,date).send({from:account});
        }
    }
  </script>
</html>
